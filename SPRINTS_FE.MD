# Monotickets Platinum â€“ Plan de Sprints Frontend

Documento vivo para coordinar la implementaciÃ³n de los pendientes del frontend frente a `FE_requirements_Monotickets_Platinum_v1.1.md`, `SRS_Monotickets_Platinum_v1.2.md` y los contratos expuestos en `BE_updates_OpenAPI_Monotickets_Platinum_v1.1.md`. Debe actualizarse al final de cada sprint (o cuando se cierre una historia relevante) indicando el estado real y los bloqueos detectados.

## Estado actual (resumen rÃ¡pido)
- La SPA Angular existe (rutas para planner/director/staff/guests), pero casi todos los servicios consumen `MockDataService` y no hay integraciÃ³n real con `monotickets-api`.
- Funcionalidades crÃ­ticas descritas en FE v1.1 (TemplateCarousel, PDFPreview+QRPlacementOverlay, PremiumEditor, DeliveryPanel completo, Scanner UI con entrada parcial, recordatorios invitados) no estÃ¡n implementadas.
- Hay riesgos de seguridad/configuraciÃ³n: `environment.ts` expone `jwtSecret` y el portal de invitados usa una API key de Maps incrustada.

## Requerimientos faltantes del documento FE v1.1

### Planner (SecciÃ³n 1 del documento)
1. **Dashboard Planner amigable (1.1)**: cards con KPIs, botÃ³n â€œNueva invitaciÃ³nâ€, estados legibles y acciones rÃ¡pidas vinculadas a `/events/{id}`.
2. **Flujo â€œNueva invitaciÃ³nâ€ (1.2)** con bloques Aâ€“D:
   - Autosave de campos mÃ­nimos vÃ­a `POST/PATCH /events`.
   - ElecciÃ³n de tipo de invitaciÃ³n (PDF vs Premium) sin cambiar de pantalla.
   - Acciones para subir CSV, generar link RSVP y link anfitriones.
   - ConfiguraciÃ³n mÃ­nima (`guestCountDefault`, `allowPartialEntry`) y CTA `POST /events/{eventId}/invitations/generate`.
3. **CatÃ¡logo PDF + Overlay QR (1.3)**:
   - TemplateCarousel filtrado por tipo.
   - Uploads propios y guardado de coordenadas para QR (`PATCH /pdf-template/qr-placement`).
4. **Resumen del evento (1.4)** como hub operativo con KPIs, acciones rÃ¡pidas y endpoints `GET /events/{id}/stats`.
5. **EnvÃ­os manuales (1.5)** con tabla de estados por canal, acciÃ³n â€œReenviarâ€.
6. **GestiÃ³n de invitados (1.6)**: GuestTable editable inline, filtros, acciones confirm/decline, revoke QR.
7. **Editor Premium (1.7)** con secciones configurables, efectos (Flipbook/Pergamino), toggles `prefers-reduced-motion`, upload multimedia y validaciones WCAG AA.
8. **MÃ©tricas del evento (1.8)** y **ConfiguraciÃ³n del Planner (1.9)** (branding default, plantillas favoritas).

### Invitado (SecciÃ³n 2)
1. **Landing antes de RSVP (2.1)**: portada, botones confirmar/aÃ±adir calendario, configuraciÃ³n de recordatorios mÃºltiples.
2. **Estados posteriores (2.2â€“2.4)**:
   - Mensaje â€œAsistencia confirmadaâ€, opciÃ³n â€œNo podrÃ¡ asistirâ€ limitada a 20 dÃ­as.
   - DÃ­a del evento con QR activo (â€œEl cÃ³digo estarÃ¡ disponibleâ€¦â€).
   - Post-evento con descarga de recuerdo PDF / vista memoria.

### Staff / Scanner (SecciÃ³n 3)
1. **Login por token (3.1)** dedicado al rol staff.
2. **Scanner UI (3.2)** con cÃ¡mara, estados VALID/INVALID/EXPIRADO/REVOCADO/NO CONFIRMADO, lista para entrada parcial y confirmaciÃ³n por nombres, sincronizaciÃ³n y modo offline que respete `POST /scanner/validate` y `POST /scanner/entry/confirm`.

### Componentes y UX Copy (SecciÃ³n 4â€“5)
- Componentes especÃ­ficos (EventCard, TemplateCarousel, PDF+Overlay, PremiumEditor, GuestTable, DeliveryPanel, Scanner UI) deben existir como librerÃ­a compartida.
- Copy obligatorio: â€œNada se envÃ­a sin tu confirmaciÃ³nâ€, â€œTu invitaciÃ³n ya estÃ¡ listaâ€, â€œPuedes personalizar despuÃ©sâ€, â€œEl cÃ³digo estarÃ¡ disponible el dÃ­a del evento.â€
- Accesibilidad: tipografÃ­a mÃ­nima 14px mobile, contraste WCAG AA, soporte `prefers-reduced-motion`.
- Empty states y alertas: sin invitados, sin invitaciones generadas, fallos delivery >10%.

## Plan por sprints

### Sprint 1 â€“ IntegraciÃ³n base y cimientos del Planner
**Objetivo:** reemplazar datos mock por API real en mÃ³dulos core y habilitar los flujos Planner 1.1â€“1.2.

- **Alcance:**
  - Conectar Auth/Planner/Guests/Director services a `monotickets-api` respetando contratos de `BE_updates_OpenAPI`.
  - Implementar Dashboard Planner (cards, KPIs, EventCard reusable) usando endpoints `GET /planners/me`, `/events?owner=me&limit=20`, `/events/{id}/stats`.
  - Reescribir â€œNueva invitaciÃ³nâ€ con bloques Aâ€“D, autosave y acciones para CSV/Rsvp/Hosts (stub UI + hooks a endpoints reales).
  - Ajustar environment/configs (sin secretos en frontend) y manejo de zonas horarias (`America/Mexico_City`).
  - Definir librerÃ­a compartida de estados/labels (Listo para enviar, Enviado, Cerrado, Bloqueado).
- **Entregables:**
  - Planner puede crear eventos reales y ver dashboard con datos backend.
  - DocumentaciÃ³n de servicios migrados (README + comentarios).
- **Dependencias:** contratos API estables, seeds mÃ­nimos en backend, definiciÃ³n de estados legibles.
- **QA/ValidaciÃ³n:** pruebas e2e bÃ¡sicas (Cypress o Playwright) para login + creaciÃ³n evento; mocks sÃ³lo permitidos en Storybook.

**Estado (15-dic-2025):** En progreso
- [x] Se agregÃ³ `environment.useMockData` (DEV on=true / PROD off) y se propagÃ³ a Auth, Planner, Guests, Director, Guest pÃºblico, Scans y Delivery services para que se conecten al backend al desactivar la bandera.
- [x] Se reescribiÃ³ la pantalla "Nueva invitaciÃ³n" con bloques A-D, autosave (POST/PATCH `/events`), cards para PDF vs Premium y acciones CSV/RSVP/Hosts conectadas a los endpoints definidos.
- [x] Se eliminÃ³ `MockDataService`, los servicios ahora consumen los endpoints reales por defecto (planner/director/guests/delivery/scans/guest portal) y se limpiÃ³ la configuraciÃ³n `useMockData`.
- [x] Dashboard Planner y las vistas de eventos usan estados legibles ("Listo para enviar", "Enviado", etc.) mediante la nueva librerÃ­a de status chips reutilizable; el Event Detail ya consume `/events/{id}/stats` para mostrar mÃ©tricas rÃ¡pidas reales.

**Notas Sprint 1:** Mantener `useMockData=true` sÃ³lo mientras se preparan seeds locales; voltearlo a `false` valida instantÃ¡neamente contra la API real sin cambios adicionales en los componentes.

### Sprint 2 â€“ Plantillas PDF, generaciÃ³n y gestiÃ³n de invitados
**Objetivo:** cubrir requerimientos 1.3, 1.5 y 1.6, ademÃ¡s de DeliveryPanel funcional.

- **Alcance:**
  - Componentes TemplateCarousel y PDFPreview+QRPlacementOverlay con interacciones drag/resize y guardado normalizado `{page,x,y,w,h,rotation}`.
  - Flujos de selecciÃ³n/Upload y persistencia de coordenadas (`POST /events/{id}/pdf-template/select|upload`, `PATCH /qr-placement`).
  - GuestTable inline edit con filtros, confirm/decline/revoke, importador CSV real (ver layouts definidos en BE doc).
  - DeliveryPanel integrado a `/delivery/send`, `/retry/{invitationId}`, mostrando stats en tiempo real y empty/failure states (>10% fallas -> alerta).
  - Copys obligatorios aplicados en las vistas del Planner.
- **Entregables:** invitaciones PDF generadas con QR posicionado, panel de invitados y deliveries operativos.
- **Dependencias:** endpoints de templates/qr placement disponibles; definiciÃ³n final de layout CSV/XLSX; assets de plantillas.
- **QA:** tests unitarios para overlay (coordenadas), pruebas de subida CSV con archivos vÃ¡lidos/errÃ³neos, flujos manuales QA para delivery/resend.

**Estado (16-dic-2025):** En progreso
- [x] Se creÃ³ `TemplateCatalog` (TemplateCarousel) accesible desde el flujo del planner, con filtros por categorÃ­a, selecciÃ³n de plantillas PDF y upload de PDFs propios conectados a los endpoints de `plannerService`.
- [x] Se implementÃ³ la pantalla `PdfQrPlacement` con preview del PDF y controles para definir `{page,x,y,width,height,rotation}` persistiendo vÃ­a `PATCH /events/{id}/pdf-template/qr-placement`.
- [x] GuestTable se conectÃ³ a los endpoints de confirmaciÃ³n/declinaciÃ³n manual y revocaciÃ³n/reenvÃ­o de invitaciones; DeliveryPanel ahora consume `GET /delivery/stats|attempts` y maneja envÃ­os/reintentos sin alerts.
- [x] La experiencia de `PdfQrPlacement` ahora usa pdf.js para renderizar el PDF real, incluye navegaciÃ³n por pÃ¡ginas, overlay arrastrable con asas de resize, sliders/inputs sincronizados y mensajes de ayuda alineados al copy oficial.
- [x] DeliveryPanel se actualiza en tiempo real (auto-refresh cada 15s), muestra mÃ©tricas por canal e historial reciente y despliega alertas cuando el ratio de fallas supera 10%, ademÃ¡s de empty states y manejo de reintentos individuales mejorado.
- [x] GuestTable incluye ediciÃ³n inline de nombre, cupo y notas rÃ¡pidas con validaciones y feedback inmediato, cubriendo el pendiente 1.6 de "gestiÃ³n rÃ¡pida" sin abandonar la vista.
- [x] El mÃ³dulo de invitados ahora muestra KPIs live del evento (confirmados, pendientes, declinados, escaneos) y se recalcula tras confirmar/declinar, ademÃ¡s de soportar selecciÃ³n mÃºltiple para confirmar/declinar/reenviar/revocar en lote.
- [x] Se habilitÃ³ el selector de efecto Flipbook/Pergamino, el toggle â€œReducir animacionesâ€ y la validaciÃ³n automÃ¡tica de contraste AA en el Premium Editor, cumpliendo la historia S3-H2.

### Sprint 3 â€“ Premium Editor y experiencia del invitado
**Objetivo:** cubrir requerimientos 1.7, 2.1â€“2.4 y parte de 4â€“5 (copy/accesibilidad).

- **Alcance:**
  - Construir PremiumEditor modular (portada, historia, galerÃ­a, ubicaciÃ³n, info adicional, RSVP, acceso). Live preview mobile + toggles.
  - Selector de â€œEfectoâ€ Flipbook/Pergamino, toggle â€œReducir animacionesâ€ respaldado por `prefers-reduced-motion`.
  - Paletas de color predefinidas por tipo de evento, validaciÃ³n contraste WCAG AA.
  - Renovar landing invitado: portada, CTA confirmar, configurador de recordatorios (3d/1sem/15d/1m) antes de descargar ICS, copy â€œNada se envÃ­aâ€¦â€.
  - Flujo post-RSVP (confirmar/declinar en 20 dÃ­as), mensaje â€œEl cÃ³digo estarÃ¡ disponible el dÃ­a del eventoâ€ y QR habilitado sÃ³lo al llegar la fecha (`GET /public/invite/{token}/access`).
  - Vista â€œRecuerdoâ€ post-evento con descarga PDF y lector de memoria.
- **Entregables:** editores premium guardando `PATCH /events/{id}/premium-config`, portal invitado completo y accesible.
- **Dependencias:** endpoints de media upload y premium config; definiciÃ³n UX final en Figma; assets (animaciones, iconos).
- **QA:** Lighthouse + axe para accesibilidad, pruebas responsive, validaciÃ³n ICS (recordatorios correctos).

#### Historias Sprint 3 (preparaciÃ³n 16-dic-2025)
- [x] **S3-H1 | Premium Editor - Estructura base:** layout de secciones (portada, historia, galerÃ­a, ubicaciÃ³n, info extra, RSVP, acceso) con preview mobile y persistencia `PATCH /events/{eventId}/premium-config`.
- [x] **S3-H2 | Efectos + accesibilidad:** selector Flipbook/Pergamino, toggle â€œReducir animacionesâ€, validaciÃ³n automÃ¡tica de contraste AA.
- [x] **S3-H3 | Landing invitado previa al RSVP:** portada premium conectada a `premiumConfig`, copy â€œNada se envÃ­a sin tu confirmaciÃ³nâ€, CTA confirmar y configurador de recordatorios 3d/1sem/15d/1m antes de descargar el .ics.
- [x] **S3-H4 | Flujo post-RSVP y dÃ­a del evento:** mensajes â€œAsistencia confirmada/No podrÃ© asistirâ€, bloqueo de QR hasta el dÃ­a del evento y copy â€œEl cÃ³digo estarÃ¡ disponible...â€.
- [x] **S3-H5 | Recuerdo post-evento:** vista solo lectura + descarga PDF reutilizando los assets del editor premium.

**Notas Sprint 3 (16-dic-2025):**
- La landing premium ya consume `premiumConfig` (cover, paleta y secciones) e integra el selector de recordatorios 3d/1sem/15d/1m antes de generar el archivo .ics.
- Se agregA3 el banner post-RSVP/QR en la landing (mensajes confirmada/declinada, bloqueo QR hasta el dA-a del evento y acciA3n "No podrA(c) asistir" limitada a 20 dA-as).
- Modo recuerdo habilitado post-evento con botones Ver invitacion/Descargar recuerdo (S3-H5 cerrado).

### Sprint 4 â€“ MÃ©tricas, configuraciÃ³n planner y Scanner UI
**Objetivo:** cerrar secciones 1.4, 1.8, 1.9, 3.1â€“3.2 y pendientes de componentes reutilizables/empty states.

- **Alcance:**
  - Event summary hub con KPIs live (`GET /events/{id}/stats`, `/invitations?limit=...`) y acciones rÃ¡pidas (enviar, ver invitados, editar, mÃ©tricas, exportar).
  - Pantalla de mÃ©tricas (delivery success, RSVP rate, show-up rate, time-to-RSVP, alertas).
  - ConfiguraciÃ³n del planner (branding por defecto, preferencias, datos de contacto).
  - Scanner UI completa: login por token, cÃ¡mara con estados detallados, entrada parcial por lista de nombres, `POST /scanner/validate` y `/scanner/entry/confirm`, modo offline con cola y sincronizaciÃ³n, historial.
  - Empty states/alertas de UX pendientes (sin invitados, sin invitaciones, fallos >10%) y consolidaciÃ³n de los componentes compartidos en `/shared`.
- **Entregables:** panel operativo listo para directores/planners, scanner funcional en campo, documentaciÃ³n UX copy aplicada.
- **Dependencias:** API de mÃ©tricas y configuraciÃ³n del planner; definiciÃ³n final de estados scanner y payload de entrada parcial; QA en dispositivos con cÃ¡mara.
- **QA:** pruebas manuales en dispositivos mÃ³viles para scanner, mÃ©tricas verificadas contra backend, tests e2e exportaciones.

**Estado (17-dic-2025):** En progreso
- [x] "EventMetrics" (S4-H1) disponible desde el resumen del evento: consume "GET /metrics/events/{eventId}" + "/events/{eventId}/stats", muestra delivery/rsvp/show-up rate, tiempo promedio de RSVP, alertas proactivas y comparativa de accesos vs confirmados.
- [x] "PlannerSettings" (S4-H2) con formulario reactivo para branding/contacto/preferencias, guardado contra "GET/PATCH /planners/me/settings" y accesible desde el dashboard como acci¢n r pida.
- [ ] Scanner UI completa (login por token, entrada parcial, sincronizaci¢n offline) - pendiente de amarrar "ScannerService" al UI y exponer los nuevos estados VALID/PARTIAL/DECLINED.
- [ ] QA responsive/accesibilidad de la landing premium y del hub del planner (ventana "No podré asistir" + modo recuerdo) — programado tras liberar Scanner.

**Notas Sprint 4:** Tras publicar m‚tricas y settings el siguiente bloque cr¡tico es Scanner (SRS 3.1-3.2); reutilizar "ScannerService" contra "/scanner/validate" y "/scanner/entry/confirm", luego ejecutar QA responsive/accesible y documentar hallazgos en GAP Report.


### Post Sprint 4 / Hardening
- AuditorÃ­a de seguridad (API keys, tokens), configuraciÃ³n de service worker/PWA si aplica, pruebas de carga para delivery y landing.
- Preparar Storybook o documentaciÃ³n de componentes reutilizables (EventCard, TemplateCarousel, etc.).

## Seguimiento y actualizaciones
1. **Al final de cada sprint:** actualizar este archivo con el estado (â€œCOMPLETADO / EN PROGRESO / BLOQUEADOâ€) por sprint y anotar bloqueos o ajustes de alcance.
2. **Nuevos hallazgos:** agregar subsecciÃ³n â€œDelta Sprint Xâ€ con decisiones de producto o cambios de contrato.
3. **SincronizaciÃ³n con GAP Report:** marcar cuando cada requerimiento FE estÃ© cubierto para poder cerrar los Ã­tems correspondientes en `GAP_REPORT_SRS_vs_IMPLEMENTACION.md`.

> Nota: cualquier cambio en las dependencias backend debe reflejarse aquÃ­ y en `BE_updates_OpenAPI_Monotickets_Platinum_v1.1.md` para mantener trazabilidad bidireccional.
