<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Estado de Envíos</h1>
            <p class="mt-2 text-sm text-gray-600">Gestiona el envío de invitaciones</p>
        </div>

        <!-- Summary Cards -->
        <div *ngIf="summary"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
            <mat-card>
                <mat-card-content class="text-center">
                    <mat-icon style="font-size: 32px; width: 32px; height: 32px;" class="text-gray-600">send</mat-icon>
                    <p class="text-2xl font-bold text-gray-900 mt-2">{{ summary.total }}</p>
                    <p class="text-sm text-gray-600">Total</p>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-content class="text-center">
                    <mat-icon
                        style="font-size: 32px; width: 32px; height: 32px; color: #10B981;">check_circle</mat-icon>
                    <p class="text-2xl font-bold text-gray-900 mt-2">{{ summary.delivered }}</p>
                    <p class="text-sm text-gray-600">Entregados</p>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-content class="text-center">
                    <mat-icon style="font-size: 32px; width: 32px; height: 32px; color: #EF4444;">error</mat-icon>
                    <p class="text-2xl font-bold text-gray-900 mt-2">{{ summary.failed }}</p>
                    <p class="text-sm text-gray-600">Fallidos</p>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-content class="text-center">
                    <mat-icon style="font-size: 32px; width: 32px; height: 32px; color: #F59E0B;">schedule</mat-icon>
                    <p class="text-2xl font-bold text-gray-900 mt-2">{{ summary.pending }}</p>
                    <p class="text-sm text-gray-600">Pendientes</p>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-content class="text-center">
                    <mat-icon style="font-size: 32px; width: 32px; height: 32px; color: #F59E0B;">warning</mat-icon>
                    <p class="text-2xl font-bold text-gray-900 mt-2">{{ summary.invalidNumbers }}</p>
                    <p class="text-sm text-gray-600">Inválidos</p>
                </mat-card-content>
            </mat-card>
        </div>

        <!-- Delivery Rate -->
        <mat-card class="mb-6" *ngIf="summary">
            <mat-card-content>
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span class="font-medium">Tasa de Entrega</span>
                    <span>{{ deliveryRate | number:'1.0-0' }}%</span>
                </div>
                <mat-progress-bar mode="determinate" [value]="deliveryRate"
                    [color]="deliveryRate > 90 ? 'primary' : deliveryRate > 70 ? 'accent' : 'warn'"></mat-progress-bar>
            </mat-card-content>
        </mat-card>

        <!-- Actions & Filters -->
        <mat-card class="mb-6">
            <mat-card-content>
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <!-- Filters -->
                    <div class="flex gap-2">
                        <button mat-stroked-button [color]="activeFilter === 'all' ? 'primary' : undefined"
                            (click)="setFilter('all')">
                            Todos
                        </button>
                        <button mat-stroked-button [color]="activeFilter === 'pending' ? 'primary' : undefined"
                            (click)="setFilter('pending')">
                            Pendientes
                        </button>
                        <button mat-stroked-button [color]="activeFilter === 'delivered' ? 'primary' : undefined"
                            (click)="setFilter('delivered')">
                            Entregados
                        </button>
                        <button mat-stroked-button [color]="activeFilter === 'failed' ? 'primary' : undefined"
                            (click)="setFilter('failed')">
                            Fallidos
                        </button>
                    </div>

                    <!-- Bulk Actions -->
                    <div class="flex gap-2">
                        <button mat-raised-button color="primary" (click)="sendBulk()"
                            [disabled]="selection.selected.length === 0 || isSending">
                            <mat-icon class="mr-2">send</mat-icon>
                            Enviar Seleccionados ({{ selection.selected.length }})
                        </button>
                    </div>
                </div>

                <!-- Sending Progress -->
                <div *ngIf="isSending" class="mt-4">
                    <p class="text-sm text-gray-600 mb-2">Enviando invitaciones...</p>
                    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Invitations Table -->
        <mat-card>
            <mat-card-content>
                <div class="overflow-auto">
                    <table mat-table [dataSource]="filteredInvitations" class="w-full">
                        <!-- Checkbox Column -->
                        <ng-container matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? toggleAllRows() : null"
                                    [checked]="selection.hasValue() && isAllSelected()"
                                    [indeterminate]="selection.hasValue() && !isAllSelected()">
                                </mat-checkbox>
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <mat-checkbox (click)="$event.stopPropagation()"
                                    (change)="$event ? selection.toggle(row) : null"
                                    [checked]="selection.isSelected(row)" [disabled]="row.status === 'delivered'">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <!-- Guest Name Column -->
                        <ng-container matColumnDef="guestName">
                            <th mat-header-cell *matHeaderCellDef>Invitado</th>
                            <td mat-cell *matCellDef="let row">{{ row.guestName }}</td>
                        </ng-container>

                        <!-- Phone Column -->
                        <ng-container matColumnDef="phone">
                            <th mat-header-cell *matHeaderCellDef>Teléfono</th>
                            <td mat-cell *matCellDef="let row">{{ row.phone }}</td>
                        </ng-container>

                        <!-- Status Column -->
                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef>Estado</th>
                            <td mat-cell *matCellDef="let row">
                                <mat-chip [class]="getStatusColor(row.status)">
                                    {{ getStatusLabel(row.status) }}
                                </mat-chip>
                            </td>
                        </ng-container>

                        <!-- Channels Column -->
                        <ng-container matColumnDef="channels">
                            <th mat-header-cell *matHeaderCellDef>Canales</th>
                            <td mat-cell *matCellDef="let row">
                                <div class="flex gap-2">
                                    <mat-icon *ngIf="row.smsStatus"
                                        [style.color]="row.smsStatus === 'success' ? '#10B981' : row.smsStatus === 'failed' ? '#EF4444' : '#6B7280'"
                                        matTooltip="SMS: {{ row.smsStatus }}">
                                        sms
                                    </mat-icon>
                                    <mat-icon *ngIf="row.whatsappStatus"
                                        [style.color]="row.whatsappStatus === 'success' ? '#10B981' : row.whatsappStatus === 'failed' ? '#EF4444' : '#6B7280'"
                                        matTooltip="WhatsApp: {{ row.whatsappStatus }}">
                                        chat
                                    </mat-icon>
                                </div>
                            </td>
                        </ng-container>

                        <!-- Actions Column -->
                        <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Acciones</th>
                            <td mat-cell *matCellDef="let row">
                                <button mat-icon-button *ngIf="row.status === 'failed'" (click)="retrySingle(row)"
                                    matTooltip="Reintentar">
                                    <mat-icon>refresh</mat-icon>
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>

                    <!-- Empty State -->
                    <div *ngIf="filteredInvitations.length === 0" class="text-center py-12">
                        <mat-icon style="font-size: 48px; width: 48px; height: 48px;"
                            class="text-gray-400">inbox</mat-icon>
                        <p class="mt-2 text-sm text-gray-600">No hay invitaciones en esta categoría</p>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>