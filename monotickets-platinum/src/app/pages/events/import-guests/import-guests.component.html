<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Importar Invitados</h1>
            <p class="mt-2 text-sm text-gray-600">Sube un archivo CSV con la lista de invitados</p>
        </div>

        <!-- Upload Section -->
        <mat-card class="mb-6">
            <mat-card-content>
                <!-- Drag & Drop Zone -->
                <div class="upload-zone" [class.dragging]="isDragging" (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="fileInput.click()">
                    <input #fileInput type="file" accept=".csv,.xlsx" (change)="onFileSelected($event)"
                        style="display: none;" />

                    <mat-icon style="font-size: 48px; width: 48px; height: 48px;" class="text-gray-400">
                        cloud_upload
                    </mat-icon>

                    <p class="mt-4 text-sm font-medium text-gray-900">
                        {{ selectedFile ? selectedFile.name : 'Arrastra tu archivo CSV aquí' }}
                    </p>

                    <p class="mt-1 text-xs text-gray-600">
                        o haz clic para seleccionar
                    </p>

                    <p class="mt-2 text-xs text-gray-500">
                        CSV o Excel (máx 5MB, 1000 invitados)
                    </p>
                </div>

                <!-- Actions -->
                <div class="flex gap-2 mt-4">
                    <button mat-raised-button color="primary" (click)="uploadFile()"
                        [disabled]="!selectedFile || isUploading">
                        <mat-icon class="mr-2">upload</mat-icon>
                        {{ isUploading ? 'Importando...' : 'Importar' }}
                    </button>

                    <button mat-stroked-button (click)="downloadTemplate()">
                        <mat-icon class="mr-2">download</mat-icon>
                        Descargar Plantilla
                    </button>

                    <button mat-button (click)="reset()" *ngIf="selectedFile">
                        Cancelar
                    </button>
                </div>

                <!-- Upload Progress -->
                <div *ngIf="isUploading" class="mt-4">
                    <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Results Section -->
        <mat-card *ngIf="importResult && !isUploading">
            <mat-card-header>
                <mat-card-title>Resultados de Importación</mat-card-title>
            </mat-card-header>

            <mat-card-content>
                <!-- Stats Grid -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="stat-card bg-green-100">
                        <mat-icon class="text-green-600">check_circle</mat-icon>
                        <p class="text-2xl font-bold text-gray-900">{{ importResult.created }}</p>
                        <p class="text-sm text-gray-600">Creados</p>
                    </div>

                    <div class="stat-card bg-yellow-100">
                        <mat-icon class="text-yellow-600">info</mat-icon>
                        <p class="text-2xl font-bold text-gray-900">{{ importResult.skipped }}</p>
                        <p class="text-sm text-gray-600">Duplicados</p>
                    </div>

                    <div class="stat-card bg-red-100">
                        <mat-icon class="text-red-600">error</mat-icon>
                        <p class="text-2xl font-bold text-gray-900">{{ importResult.invalid }}</p>
                        <p class="text-sm text-gray-600">Errores</p>
                    </div>
                </div>

                <!-- Success Rate -->
                <div class="mb-4">
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Tasa de éxito</span>
                        <span>{{ successRate | number:'1.0-0' }}%</span>
                    </div>
                    <mat-progress-bar mode="determinate" [value]="successRate"
                        [color]="successRate > 90 ? 'primary' : successRate > 70 ? 'accent' : 'warn'"></mat-progress-bar>
                </div>

                <!-- Errors Table -->
                <div *ngIf="importResult.errors.length > 0">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Errores Encontrados</h3>

                    <div class="overflow-auto">
                        <table mat-table [dataSource]="importResult.errors" class="w-full">
                            <!-- Row Column -->
                            <ng-container matColumnDef="row">
                                <th mat-header-cell *matHeaderCellDef>Fila</th>
                                <td mat-cell *matCellDef="let error">{{ error.row }}</td>
                            </ng-container>

                            <!-- Field Column -->
                            <ng-container matColumnDef="field">
                                <th mat-header-cell *matHeaderCellDef>Campo</th>
                                <td mat-cell *matCellDef="let error">{{ error.field }}</td>
                            </ng-container>

                            <!-- Value Column -->
                            <ng-container matColumnDef="value">
                                <th mat-header-cell *matHeaderCellDef>Valor</th>
                                <td mat-cell *matCellDef="let error">{{ error.value }}</td>
                            </ng-container>

                            <!-- Reason Column -->
                            <ng-container matColumnDef="reason">
                                <th mat-header-cell *matHeaderCellDef>Razón</th>
                                <td mat-cell *matCellDef="let error">{{ error.reason }}</td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>
                    </div>
                </div>

                <!-- Success Message -->
                <div *ngIf="importResult.created > 0 && importResult.invalid === 0"
                    class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-sm text-green-800">
                        ✓ Todos los invitados fueron importados correctamente
                    </p>
                </div>
            </mat-card-content>

            <mat-card-actions>
                <button mat-raised-button color="primary" [routerLink]="['/events', eventId]">
                    Ver Invitados
                </button>
                <button mat-button (click)="reset()">
                    Importar Más
                </button>
            </mat-card-actions>
        </mat-card>
    </div>
</div>