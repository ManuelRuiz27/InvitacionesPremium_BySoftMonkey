<div class="scans-panel">
    <div class="header">
        <div class="header-left">
            <button mat-icon-button (click)="goBack()">
                <mat-icon>arrow_back</mat-icon>
            </button>
            <h2>
                <mat-icon>qr_code_scanner</mat-icon>
                Panel de Escaneos
            </h2>
        </div>
        <button mat-raised-button (click)="exportCSV()">
            <mat-icon>download</mat-icon>
            Exportar CSV
        </button>
    </div>

    <!-- Stats Section -->
    <div class="stats-section" *ngIf="stats">
        <div class="stat-card primary">
            <div class="stat-content">
                <span class="stat-value">{{ stats.attendanceRate.toFixed(1) }}%</span>
                <span class="stat-label">Asistencia</span>
            </div>
            <mat-icon>trending_up</mat-icon>
        </div>
        <div class="stat-card">
            <div class="stat-content">
                <span class="stat-value">{{ stats.scannedGuests }} / {{ stats.totalGuests }}</span>
                <span class="stat-label">Invitados</span>
            </div>
            <mat-icon>people</mat-icon>
        </div>
        <div class="stat-card success">
            <div class="stat-content">
                <span class="stat-value">{{ stats.validScans }}</span>
                <span class="stat-label">Válidos</span>
            </div>
            <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-card warning">
            <div class="stat-content">
                <span class="stat-value">{{ stats.duplicateScans }}</span>
                <span class="stat-label">Duplicados</span>
            </div>
            <mat-icon>content_copy</mat-icon>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <mat-button-toggle-group [value]="filter" (change)="onFilterChange($event.value)">
            <mat-button-toggle value="all">
                Todos ({{ scans.length }})
            </mat-button-toggle>
            <mat-button-toggle value="valid">
                Válidos ({{ getValidCount() }})
            </mat-button-toggle>
            <mat-button-toggle value="duplicate">
                Duplicados ({{ getDuplicateCount() }})
            </mat-button-toggle>
            <mat-button-toggle value="invalid">
                Inválidos ({{ getInvalidCount() }})
            </mat-button-toggle>
        </mat-button-toggle-group>
    </div>

    <!-- Scans Table -->
    <div class="table-section">
        <div class="loading-container" *ngIf="loading">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Cargando escaneos...</p>
        </div>

        <table mat-table [dataSource]="filteredScans" *ngIf="!loading && filteredScans.length > 0">
            <ng-container matColumnDef="guestName">
                <th mat-header-cell *matHeaderCellDef>Invitado</th>
                <td mat-cell *matCellDef="let scan">{{ scan.guestName }}</td>
            </ng-container>

            <ng-container matColumnDef="guestCount">
                <th mat-header-cell *matHeaderCellDef>Personas</th>
                <td mat-cell *matCellDef="let scan">
                    <mat-chip class="chip-count">
                        <mat-icon>people</mat-icon>
                        {{ scan.guestCount }}
                    </mat-chip>
                </td>
            </ng-container>

            <ng-container matColumnDef="scannedAt">
                <th mat-header-cell *matHeaderCellDef>Fecha/Hora</th>
                <td mat-cell *matCellDef="let scan">{{ formatDateTime(scan.scannedAt) }}</td>
            </ng-container>

            <ng-container matColumnDef="result">
                <th mat-header-cell *matHeaderCellDef>Resultado</th>
                <td mat-cell *matCellDef="let scan">
                    <mat-chip [class]="'chip-' + scan.scanResult.toLowerCase()">
                        <mat-icon>{{ getResultIcon(scan.scanResult) }}</mat-icon>
                        {{ scan.scanResult }}
                    </mat-chip>
                </td>
            </ng-container>

            <ng-container matColumnDef="staff">
                <th mat-header-cell *matHeaderCellDef>Staff</th>
                <td mat-cell *matCellDef="let scan">{{ scan.scannedByStaffName }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <div class="empty-state" *ngIf="!loading && filteredScans.length === 0">
            <mat-icon>qr_code_scanner</mat-icon>
            <p>No hay escaneos registrados</p>
            <span>Los escaneos aparecerán aquí en tiempo real</span>
        </div>
    </div>
</div>