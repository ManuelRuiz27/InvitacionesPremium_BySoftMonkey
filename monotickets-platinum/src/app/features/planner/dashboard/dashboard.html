<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="welcome">
            <h1>¡Hola, {{ userName }}!</h1>
            <p>Bienvenido a tu panel de control</p>
        </div>
        <button mat-raised-button color="warn" (click)="logout()" class="logout-btn">
            <mat-icon>logout</mat-icon>
            Cerrar Sesión
        </button>
    </div>

    @if (loading) {
    <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando dashboard...</p>
    </div>
    } @else {
    <!-- Metrics Cards -->
    <div class="metrics-grid">
        <mat-card class="metric-card events">
            <div class="metric-icon">
                <mat-icon>event</mat-icon>
            </div>
            <div class="metric-content">
                <h3>Eventos Totales</h3>
                <p class="metric-value">{{ metrics?.totalEvents || 0 }}</p>
            </div>
        </mat-card>

        <mat-card class="metric-card invitations">
            <div class="metric-icon">
                <mat-icon>mail</mat-icon>
            </div>
            <div class="metric-content">
                <h3>Invitaciones</h3>
                <p class="metric-value">{{ metrics?.totalInvitations || 0 }}</p>
            </div>
        </mat-card>

        <mat-card class="metric-card confirmations">
            <div class="metric-icon">
                <mat-icon>check_circle</mat-icon>
            </div>
            <div class="metric-content">
                <h3>Confirmaciones</h3>
                <p class="metric-value">{{ metrics?.totalConfirmations || 0 }}</p>
            </div>
        </mat-card>

        <mat-card class="metric-card rate">
            <div class="metric-icon">
                <mat-icon>trending_up</mat-icon>
            </div>
            <div class="metric-content">
                <h3>Tasa de Confirmación</h3>
                <p class="metric-value">{{ metrics?.confirmationRate || 0 }}%</p>
            </div>
        </mat-card>
    </div>

    <!-- Main Content -->
    <div class="content-grid">
        <!-- Chart Card -->
        <mat-card class="chart-card">
            <mat-card-header>
                <mat-card-title>Eventos por Tipo</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                @if (metrics && metrics.eventsByType.length > 0) {
                <div class="chart-container">
                    <canvas baseChart [data]="doughnutChartData" [options]="doughnutChartOptions" type="doughnut">
                    </canvas>
                </div>
                } @else {
                <div class="no-data">
                    <mat-icon>pie_chart</mat-icon>
                    <p>No hay eventos para mostrar</p>
                </div>
                }
            </mat-card-content>
        </mat-card>

        <!-- Upcoming Events Card -->
        <mat-card class="upcoming-card">
            <mat-card-header>
                <mat-card-title>Próximos eventos</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                @if (upcomingEvents.length > 0) {
                <mat-list>
                    @for (event of upcomingEvents; track event.id) {
                    <mat-list-item (click)="navigateToEventDetail(event.id)" class="event-item">
                        <mat-icon matListItemIcon>event</mat-icon>
                        <div matListItemTitle>{{ event.name }}</div>
                        <div matListItemLine class="event-meta">
                            <span>{{ formatDate(event.date) }} • {{ event.time }}</span>
                            <mat-chip [ngClass]="getStatusMeta(event.status).className" disableRipple>
                                <mat-icon>{{ getStatusMeta(event.status).icon }}</mat-icon>
                                {{ getStatusMeta(event.status).label }}
                            </mat-chip>
                        </div>
                    </mat-list-item>
                    }
                </mat-list>
                } @else {
                <div class="no-data">
                    <mat-icon>event_busy</mat-icon>
                    <p>No hay eventos próximos</p>
                </div>
                }
            </mat-card-content>
            <mat-card-actions>
                <button mat-button color="primary" (click)="navigateToEvents()">
                    Ver Todos los Eventos
                </button>
            </mat-card-actions>
        </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2>Acciones Rápidas</h2>
        <div class="actions-grid">
            <mat-card class="action-card create" (click)="navigateToCreateEvent()">
                <mat-icon>add_circle</mat-icon>
                <h3>Crear Nuevo Evento</h3>
                <p>Comienza a planear tu próximo evento</p>
            </mat-card>

            <mat-card class="action-card events" (click)="navigateToEvents()">
                <mat-icon>list</mat-icon>
                <h3>Ver Mis Eventos</h3>
                <p>Administra todos tus eventos</p>
            </mat-card>

            <mat-card class="action-card settings" (click)="navigateToSettings()">
                <mat-icon>tune</mat-icon>
                <h3>Configurar defaults</h3>
                <p>Branding, colores y datos de contacto</p>
            </mat-card>
        </div>
    </div>
    }
</div>

