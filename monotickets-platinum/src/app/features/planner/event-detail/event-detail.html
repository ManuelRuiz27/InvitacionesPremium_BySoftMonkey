<div class="detail-container">
    <div class="page-header">
        <button mat-icon-button class="back-btn" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>
        @if (event) {
        <div class="header-info">
            <p class="eyebrow">Resumen del evento</p>
            <div class="title-row">
                <h1>{{ event.name }}</h1>
                <mat-chip [ngClass]="getStatusColor(event.status)">
                    {{ getStatusLabel(event.status) }}
                </mat-chip>
            </div>
            <div class="meta-row">
                <span>
                    <mat-icon>event</mat-icon>
                    {{ formatDate(event.date) }} - {{ event.time }}
                </span>
                <span *ngIf="event.locationText">
                    <mat-icon>place</mat-icon>
                    {{ event.locationText }}
                </span>
                <span>
                    <mat-icon>palette</mat-icon>
                    {{ event.templateType === 'PREMIUM' ? 'Premium' : 'PDF' }}
                </span>
            </div>
        </div>
        <div class="header-actions">
            <button mat-stroked-button color="primary" (click)="editEvent()">
                <mat-icon>edit</mat-icon>
                Editar
            </button>
            <button mat-stroked-button color="warn" (click)="deleteEvent()">
                <mat-icon>delete</mat-icon>
                Eliminar
            </button>
        </div>
        } @else {
        <h1>Detalle del evento</h1>
        }
    </div>

    @if (loading) {
    <div class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Cargando evento...</p>
    </div>
    } @else if (event) {
    <div class="overview-gap">
        <mat-card class="stats-card">
            <mat-card-header>
                <mat-card-title>Indicadores del evento</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="kpi-grid">
                    <div class="kpi-card" *ngFor="let kpi of kpis">
                        <mat-icon>{{ kpi.icon }}</mat-icon>
                        <div>
                            <p class="kpi-value">{{ getKpiValue(kpi.key) }}</p>
                            <p class="kpi-label">{{ kpi.label }}</p>
                        </div>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="info-card">
            <mat-card-header>
                <mat-card-title>Información general</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="info-grid">
                    <div class="info-item">
                        <mat-icon>category</mat-icon>
                        <div>
                            <label>Tipo</label>
                            <p>{{ getTypeLabel(event.type) }}</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <mat-icon>event</mat-icon>
                        <div>
                            <label>Fecha</label>
                            <p>{{ formatDate(event.date) }}</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <mat-icon>schedule</mat-icon>
                        <div>
                            <label>Hora</label>
                            <p>{{ event.time }}</p>
                        </div>
                    </div>
                    <div class="info-item full-width">
                        <mat-icon>location_on</mat-icon>
                        <div>
                            <label>Ubicación</label>
                            <p>{{ event.locationText }}</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <mat-icon>palette</mat-icon>
                        <div>
                            <label>Plantilla</label>
                            <p>{{ event.templateType === 'PREMIUM' ? 'Premium' : 'PDF' }}</p>
                        </div>
                    </div>
                    @if (event.templateVariant) {
                    <div class="info-item">
                        <mat-icon>style</mat-icon>
                        <div>
                            <label>Variante</label>
                            <p>{{ event.templateVariant }}</p>
                        </div>
                    </div>
                    }
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="actions-card">
            <mat-card-header>
                <mat-card-title>Acciones rápidas</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="action-buttons primary">
                    <button mat-stroked-button (click)="sendInvitations()">
                        <mat-icon>send</mat-icon>
                        Enviar invitaciones
                    </button>
                    <button mat-stroked-button (click)="navigateToGuests()">
                        <mat-icon>people</mat-icon>
                        Ver invitados
                    </button>
                    <button mat-stroked-button (click)="customizeInvitation()">
                        <mat-icon>brush</mat-icon>
                        Editar invitación
                    </button>
                    <button mat-stroked-button (click)="viewMetrics()">
                        <mat-icon>insights</mat-icon>
                        Ver métricas
                    </button>
                    <button mat-stroked-button (click)="openExportDialog()">
                        <mat-icon>file_download</mat-icon>
                        Exportar lista
                    </button>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card class="secondary-actions-card">
            <mat-card-header>
                <mat-card-title>Operación del evento</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <div class="action-buttons secondary">
                    <button mat-raised-button class="action-btn" (click)="navigateToInvitations()">
                        <mat-icon>mail</mat-icon>
                        Gestionar invitaciones
                    </button>
                    <button mat-raised-button class="action-btn" (click)="viewScans()">
                        <mat-icon>qr_code_scanner</mat-icon>
                        Panel de escaneos
                    </button>
                    <button mat-raised-button class="action-btn" (click)="manageRSVP()">
                        <mat-icon>link</mat-icon>
                        Formulario público
                    </button>
                    <button mat-raised-button class="action-btn" (click)="manageHostLinks()">
                        <mat-icon>admin_panel_settings</mat-icon>
                        Links anfitriones
                    </button>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    }
</div>

<ng-template #exportDialog>
    <h2 mat-dialog-title>Exportar lista de invitados</h2>
    <mat-dialog-content>
        <p>Selecciona el formato en el que deseas descargar la lista.</p>
        <mat-radio-group [(ngModel)]="exportFormat" class="export-radio-group">
            <mat-radio-button value="csv">CSV (separado por comas)</mat-radio-button>
            <mat-radio-button value="xlsx">Excel (.xlsx)</mat-radio-button>
        </mat-radio-group>
        <p class="dialog-hint">Consulta las columnas en EXPORT_FORMATOS_MONOTICKETS.md.</p>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-button mat-dialog-close [disabled]="exporting">Cancelar</button>
        <button mat-raised-button color="primary" (click)="confirmExport()" [disabled]="exporting">
            {{ exporting ? 'Generando...' : 'Descargar' }}
        </button>
    </mat-dialog-actions>
</ng-template>
